<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Asteroids JS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #0d0d10;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            touch-action: none; /* Prevent mobile scrolling */
        }

        #gameCanvas {
            display: block;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .score-board {
            padding: 20px;
            color: #fff;
            font-size: 24px;
            text-shadow: 0 0 5px #fff;
            display: flex;
            justify-content: space-between;
        }

        .center-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #fff;
            pointer-events: auto;
        }

        h1 {
            font-size: 48px;
            margin: 0 0 20px 0;
            text-shadow: 0 0 10px #0ff;
            letter-spacing: 5px;
        }

        p {
            font-size: 18px;
            color: #aaa;
        }

        button.btn-primary {
            background: transparent;
            border: 2px solid #0ff;
            color: #0ff;
            padding: 15px 40px;
            font-size: 20px;
            font-family: inherit;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        button.btn-primary:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
        }

        /* Mobile Controls */
        .controls-area {
            display: none; /* Hidden on desktop by default, shown via JS if touch */
            width: 100%;
            height: 180px;
            padding-bottom: 20px;
            pointer-events: auto;
            justify-content: space-between;
            align-items: center;
        }

        .d-pad {
            margin-left: 20px;
            position: relative;
            width: 150px;
            height: 150px;
        }

        .action-btn {
            margin-right: 30px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 50, 50, 0.2);
            border: 2px solid #f55;
            color: #f55;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            -webkit-user-select: none;
        }

        .action-btn:active {
            background: rgba(255, 50, 50, 0.6);
        }

        .d-btn {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #0ff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0ff;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .d-btn:active { background: rgba(0, 255, 255, 0.4); }
        .d-up { top: 0; left: 50px; }
        .d-left { top: 50px; left: 0; }
        .d-right { top: 50px; left: 100px; }

        @media (max-width: 768px) {
            .controls-area {
                display: flex;
            }
            h1 { font-size: 32px; }
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="score-board">
            <span id="scoreEl">SCORE: 0</span>
            <span id="livesEl">LIVES: 3</span>
        </div>

        <div id="startScreen" class="center-msg">
            <h1>ASTEROIDS</h1>
            <p>Use Arrow Keys to Move • Space to Shoot</p>
            <br>
            <button class="btn-primary" onclick="startGame()">Start Game</button>
        </div>

        <div id="gameOverScreen" class="center-msg" style="display: none;">
            <h1 style="color: #f55; text-shadow: 0 0 10px #f00;">GAME OVER</h1>
            <p id="finalScore">Score: 0</p>
            <br>
            <button class="btn-primary" onclick="startGame()">Play Again</button>
        </div>

        <!-- Touch Controls -->
        <div class="controls-area" id="touchControls">
            <div class="d-pad">
                <div class="d-btn d-up" id="btnThrust">▲</div>
                <div class="d-btn d-left" id="btnLeft">◀</div>
                <div class="d-btn d-right" id="btnRight">▶</div>
            </div>
            <div class="action-btn" id="btnFire">FIRE</div>
        </div>
    </div>

<script>
    /**
     * GAME CONFIGURATION & STATE
     */
    const FPS = 60;
    const FRICTION = 0.7; // 0 = no friction, 1 = lots of friction
    const SHIP_SIZE = 30; // height in pixels
    const TURN_SPEED = 360; // degrees per second
    const SHIP_THRUST = 5; // acceleration pixels per second per second
    const LASER_MAX = 10; // max lasers on screen
    const LASER_SPD = 500; // px per sec
    const LASER_DIST = 0.6; // max distance laser can travel as fraction of screen width
    const ROIDS_NUM = 3; // starting number of asteroids
    const ROIDS_SIZE = 100; // starting size in pixels
    const ROIDS_SPD = 50; // max starting speed in pixels per second
    const ROIDS_VERT = 10; // average number of vertices on each asteroid
    const ROIDS_JAG = 0.4; // jaggedness of the asteroids (0 = none, 1 = lots)
    const SHOW_BOUNDING = false; // show collision bounding
    const SHIP_INV_DUR = 3; // duration of invisibility in seconds

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // UI Elements
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const scoreEl = document.getElementById('scoreEl');
    const livesEl = document.getElementById('livesEl');
    const finalScoreEl = document.getElementById('finalScore');

    // Game State
    let level, lives, roids, ship, text, textAlpha, score, highScore;
    let playing = false;
    let gameLoopId;

    // Inputs
    let keys = {
        ArrowUp: false,
        ArrowLeft: false,
        ArrowRight: false,
        Space: false
    };

    // Audio Context (Initialized on user interaction)
    let audioCtx = null;

    /**
     * SETUP & EVENTS
     */
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Keyboard Listeners
    document.addEventListener('keydown', keyDown);
    document.addEventListener('keyup', keyUp);

    function keyDown(ev) {
        if(ev.code === 'ArrowUp') keys.ArrowUp = true;
        if(ev.code === 'ArrowLeft') keys.ArrowLeft = true;
        if(ev.code === 'ArrowRight') keys.ArrowRight = true;
        if(ev.code === 'Space') keys.Space = true;
    }

    function keyUp(ev) {
        if(ev.code === 'ArrowUp') keys.ArrowUp = false;
        if(ev.code === 'ArrowLeft') keys.ArrowLeft = false;
        if(ev.code === 'ArrowRight') keys.ArrowRight = false;
        if(ev.code === 'Space') keys.Space = false;
    }

    // Touch Listeners
    const btnThrust = document.getElementById('btnThrust');
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');
    const btnFire = document.getElementById('btnFire');

    const setupTouch = (elem, code) => {
        elem.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; });
        elem.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; });
    };

    setupTouch(btnThrust, 'ArrowUp');
    setupTouch(btnLeft, 'ArrowLeft');
    setupTouch(btnRight, 'ArrowRight');
    setupTouch(btnFire, 'Space');

    /**
     * AUDIO SYSTEM (Synthesizer)
     */
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    function playSound(type) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        const now = audioCtx.currentTime;

        if (type === 'laser') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(800, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now);
            osc.stop(now + 0.1);
        } else if (type === 'explode') {
            // White noise simulation for explosion is complex in pure oscillator
            // Using low frequency saw for rumble
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, now);
            osc.frequency.exponentialRampToValueAtTime(1, now + 0.3);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
        } else if (type === 'thrust') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(100, now);
            gain.gain.setValueAtTime(0.05, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now);
            osc.stop(now + 0.1);
        }
    }

    /**
     * GAME LOGIC
     */

    function newShip() {
        return {
            x: canvas.width / 2,
            y: canvas.height / 2,
            a: 90 / 180 * Math.PI, // convert to radians
            r: SHIP_SIZE / 2,
            blinkNum: Math.ceil(SHIP_INV_DUR / 0.1),
            blinkTime: Math.ceil(0.1 * FPS),
            canShoot: true,
            dead: false,
            lasers: [],
            rot: 0,
            thrusting: false,
            thrust: { x: 0, y: 0 }
        };
    }

    function shootLaser() {
        // create laser object
        if (ship.canShoot && ship.lasers.length < LASER_MAX) {
            ship.lasers.push({ // from the nose of the ship
                x: ship.x + 4/3 * ship.r * Math.cos(ship.a),
                y: ship.y - 4/3 * ship.r * Math.sin(ship.a),
                xv: LASER_SPD * Math.cos(ship.a) / FPS,
                yv: -LASER_SPD * Math.sin(ship.a) / FPS,
                dist: 0
            });
            playSound('laser');
            
            // prevent rapid fire
            ship.canShoot = false;
            setTimeout(() => ship.canShoot = true, 200);
        }
    }

    function createAsteroidBelt() {
        roids = [];
        let x, y;
        for (let i = 0; i < ROIDS_NUM + level; i++) {
            // random asteroid location (not touching spaceship)
            do {
                x = Math.floor(Math.random() * canvas.width);
                y = Math.floor(Math.random() * canvas.height);
            } while (distBetweenPoints(ship.x, ship.y, x, y) < ROIDS_SIZE * 2 + ship.r);
            roids.push(newAsteroid(x, y, Math.ceil(ROIDS_SIZE / 2)));
        }
    }

    function newAsteroid(x, y, r) {
        let lvlMult = 1 + 0.1 * level;
        let roid = {
            x: x,
            y: y,
            xv: Math.random() * ROIDS_SPD * lvlMult / FPS * (Math.random() < 0.5 ? 1 : -1),
            yv: Math.random() * ROIDS_SPD * lvlMult / FPS * (Math.random() < 0.5 ? 1 : -1),
            a: Math.random() * Math.PI * 2, // in radians
            r: r,
            offs: [],
            vert: Math.floor(Math.random() * (ROIDS_VERT + 1) + ROIDS_VERT / 2)
        };

        // populate the offsets array
        for (let i = 0; i < roid.vert; i++) {
            roid.offs.push(Math.random() * ROIDS_JAG * 2 + 1 - ROIDS_JAG);
        }

        return roid;
    }

    function distBetweenPoints(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }

    function explodeShip() {
        ship.explodeTime = Math.ceil(0.3 * FPS);
        playSound('explode');
    }

    function startGame() {
        initAudio(); // Init audio context on user gesture
        level = 0;
        lives = 3;
        score = 0;
        ship = newShip();
        scoreEl.innerText = 'SCORE: ' + score;
        livesEl.innerText = 'LIVES: ' + lives;
        
        startScreen.style.display = 'none';
        gameOverScreen.style.display = 'none';
        
        // Show touch controls if on mobile/touch device roughly
        if('ontouchstart' in window || navigator.maxTouchPoints > 0) {
            document.getElementById('touchControls').style.display = 'flex';
        }

        playing = true;
        newLevel();
        
        if(gameLoopId) clearInterval(gameLoopId);
        gameLoopId = setInterval(update, 1000 / FPS);
    }

    function newLevel() {
        text = "LEVEL " + (level + 1);
        textAlpha = 1.0;
        createAsteroidBelt();
    }

    function gameOver() {
        ship.dead = true;
        playing = false;
        finalScoreEl.innerText = "Final Score: " + score;
        gameOverScreen.style.display = 'block';
        clearInterval(gameLoopId);
    }

    function update() {
        let blinkOn = ship.blinkNum % 2 == 0;
        let exploding = ship.explodeTime > 0;

        // Draw Space
        ctx.fillStyle = "#0d0d10";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Asteroids
        ctx.lineWidth = 1.5;
        for (let i = 0; i < roids.length; i++) {
            ctx.strokeStyle = "slategray";
            let x = roids[i].x;
            let y = roids[i].y;
            let r = roids[i].r;
            let a = roids[i].a;
            let vert = roids[i].vert;
            let offs = roids[i].offs;

            // draw path
            ctx.beginPath();
            for (let j = 0; j < vert; j++) {
                ctx.lineTo(
                    x + r * offs[j] * Math.cos(a + j * Math.PI * 2 / vert),
                    y + r * offs[j] * Math.sin(a + j * Math.PI * 2 / vert)
                );
            }
            ctx.closePath();
            ctx.stroke();

            // move asteroid
            roids[i].x += roids[i].xv;
            roids[i].y += roids[i].yv;

            // handle edge of screen
            if (roids[i].x < 0 - roids[i].r) roids[i].x = canvas.width + roids[i].r;
            else if (roids[i].x > canvas.width + roids[i].r) roids[i].x = 0 - roids[i].r;
            if (roids[i].y < 0 - roids[i].r) roids[i].y = canvas.height + roids[i].r;
            else if (roids[i].y > canvas.height + roids[i].r) roids[i].y = 0 - roids[i].r;
        }

        // Draw Ship
        if (!exploding) {
            if (blinkOn && !ship.dead) {
                drawShip(ship.x, ship.y, ship.a);
            }

            // handle blinking
            if (ship.blinkNum > 0) {
                ship.blinkTime--;
                if (ship.blinkTime == 0) {
                    ship.blinkTime = Math.ceil(0.1 * FPS);
                    ship.blinkNum--;
                }
            }
        } else {
            // Draw explosion
            ctx.fillStyle = "darkred";
            ctx.beginPath();
            ctx.arc(ship.x, ship.y, ship.r * 1.7, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.fillStyle = "red";
            ctx.beginPath();
            ctx.arc(ship.x, ship.y, ship.r * 1.4, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.fillStyle = "orange";
            ctx.beginPath();
            ctx.arc(ship.x, ship.y, ship.r * 1.1, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(ship.x, ship.y, ship.r * 0.8, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(ship.x, ship.y, ship.r * 0.5, 0, Math.PI * 2, false);
            ctx.fill();
        }

        // Draw Lasers
        for (let i = 0; i < ship.lasers.length; i++) {
            ctx.fillStyle = "salmon";
            ctx.beginPath();
            ctx.arc(ship.lasers[i].x, ship.lasers[i].y, SHIP_SIZE / 15, 0, Math.PI * 2, false);
            ctx.fill();
        }

        // Detect Laser Hits on Asteroids
        let ax, ay, ar, lx, ly;
        for (let i = roids.length - 1; i >= 0; i--) {
            ax = roids[i].x;
            ay = roids[i].y;
            ar = roids[i].r;

            for (let j = ship.lasers.length - 1; j >= 0; j--) {
                lx = ship.lasers[j].x;
                ly = ship.lasers[j].y;

                if (distBetweenPoints(ax, ay, lx, ly) < ar) {
                    // destroy asteroid
                    destroyAsteroid(i);
                    ship.lasers.splice(j, 1);
                    break;
                }
            }
        }

        // Check for asteroid collision (when not blinking)
        if (!exploding && ship.blinkNum == 0 && !ship.dead) {
            for (let i = 0; i < roids.length; i++) {
                if (distBetweenPoints(ship.x, ship.y, roids[i].x, roids[i].y) < ship.r + roids[i].r) {
                    explodeShip();
                    destroyAsteroid(i);
                    break;
                }
            }
        }

        // Move Ship
        if (!exploding && !ship.dead) {
            ship.rot = 0;
            if(keys.ArrowLeft) ship.rot = TURN_SPEED / 180 * Math.PI / FPS;
            if(keys.ArrowRight) ship.rot = -TURN_SPEED / 180 * Math.PI / FPS;
            ship.a += ship.rot;

            if (keys.Space && ship.canShoot) shootLaser();

            if(keys.ArrowUp) {
                ship.thrust.x += SHIP_THRUST * Math.cos(ship.a) / FPS;
                ship.thrust.y -= SHIP_THRUST * Math.sin(ship.a) / FPS;
                playSound('thrust');
                
                // Draw Thruster
                if(blinkOn) {
                    ctx.fillStyle = "orange";
                    ctx.strokeStyle = "yellow";
                    ctx.lineWidth = SHIP_SIZE / 10;
                    ctx.beginPath();
                    ctx.moveTo( // rear left
                        ship.x - ship.r * (2/3 * Math.cos(ship.a) + 0.5 * Math.sin(ship.a)),
                        ship.y + ship.r * (2/3 * Math.sin(ship.a) - 0.5 * Math.cos(ship.a))
                    );
                    ctx.lineTo( // rear center (behind the ship)
                        ship.x - ship.r * 5/3 * Math.cos(ship.a),
                        ship.y + ship.r * 5/3 * Math.sin(ship.a)
                    );
                    ctx.lineTo( // rear right
                        ship.x - ship.r * (2/3 * Math.cos(ship.a) - 0.5 * Math.sin(ship.a)),
                        ship.y + ship.r * (2/3 * Math.sin(ship.a) + 0.5 * Math.cos(ship.a))
                    );
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                }
            } else {
                ship.thrust.x -= FRICTION * ship.thrust.x / FPS;
                ship.thrust.y -= FRICTION * ship.thrust.y / FPS;
            }

            ship.x += ship.thrust.x;
            ship.y += ship.thrust.y;

            // Screen edge handling - Instant Wrapping
            if (ship.x < 0) ship.x = canvas.width;
            else if (ship.x > canvas.width) ship.x = 0;
            if (ship.y < 0) ship.y = canvas.height;
            else if (ship.y > canvas.height) ship.y = 0;
            
        } else if (exploding) {
            ship.explodeTime--;
            if (ship.explodeTime == 0) {
                lives--;
                livesEl.innerText = 'LIVES: ' + lives;
                if (lives == 0) {
                    gameOver();
                } else {
                    ship = newShip();
                }
            }
        }

        // Move Lasers
        for (let i = ship.lasers.length - 1; i >= 0; i--) {
            ship.lasers[i].x += ship.lasers[i].xv;
            ship.lasers[i].y += ship.lasers[i].yv;
            ship.lasers[i].dist += Math.sqrt(Math.pow(ship.lasers[i].xv, 2) + Math.pow(ship.lasers[i].yv, 2));

            if (ship.lasers[i].dist > canvas.width * LASER_DIST) {
                ship.lasers.splice(i, 1);
                continue;
            }

            // handle edge
            if (ship.lasers[i].x < 0) ship.lasers[i].x = canvas.width;
            else if (ship.lasers[i].x > canvas.width) ship.lasers[i].x = 0;
            if (ship.lasers[i].y < 0) ship.lasers[i].y = canvas.height;
            else if (ship.lasers[i].y > canvas.height) ship.lasers[i].y = 0;
        }

        // Draw Level Text
        if (textAlpha >= 0) {
            ctx.fillStyle = "rgba(255, 255, 255, " + textAlpha + ")";
            ctx.font = "small-caps 40px Courier New";
            ctx.textAlign = "center";
            ctx.fillText(text, canvas.width / 2, canvas.height * 0.75);
            textAlpha -= (1.0 / 2.5) / FPS;
        }

        // Check for level completion
        if (roids.length == 0) {
            level++;
            newLevel();
        }
    }

    function destroyAsteroid(index) {
        let x = roids[index].x;
        let y = roids[index].y;
        let r = roids[index].r;

        // split asteroid
        if (r == Math.ceil(ROIDS_SIZE / 2)) { // large
            roids.push(newAsteroid(x, y, Math.ceil(ROIDS_SIZE / 4)));
            roids.push(newAsteroid(x, y, Math.ceil(ROIDS_SIZE / 4)));
            score += 20;
        } else if (r == Math.ceil(ROIDS_SIZE / 4)) { // medium
            roids.push(newAsteroid(x, y, Math.ceil(ROIDS_SIZE / 8)));
            roids.push(newAsteroid(x, y, Math.ceil(ROIDS_SIZE / 8)));
            score += 50;
        } else {
            score += 100;
        }
        
        roids.splice(index, 1);
        playSound('explode');
        scoreEl.innerText = 'SCORE: ' + score;
    }

    function drawShip(x, y, a) {
        ctx.strokeStyle = "white";
        ctx.lineWidth = SHIP_SIZE / 20;
        ctx.beginPath();
        ctx.moveTo( // nose
            x + 4/3 * ship.r * Math.cos(a),
            y - 4/3 * ship.r * Math.sin(a)
        );
        ctx.lineTo( // rear left
            x - ship.r * (2/3 * Math.cos(a) + Math.sin(a)),
            y + ship.r * (2/3 * Math.sin(a) - Math.cos(a))
        );
        ctx.lineTo( // rear right
            x - ship.r * (2/3 * Math.cos(a) - Math.sin(a)),
            y + ship.r * (2/3 * Math.sin(a) + Math.cos(a))
        );
        ctx.closePath();
        ctx.stroke();
    }
</script>
</body>
</html>
